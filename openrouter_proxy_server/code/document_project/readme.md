# OpenRouter Proxy Server

## Описание
Прокси-сервер для OpenRouter API с поддержкой множественных API-ключей, автоматической ротацией и восстановлением ключей.

## Основные возможности
- Управление множественными API-ключами
- Автоматическая ротация ключей при ошибках
- Экспоненциальная задержка при повторных попытках
- Расширенное логирование всех операций
- Конфигурируемые параметры через config.ini
- Поддержка асинхронных операций
- Модульная архитектура

## Структура проекта
```
openrouter_proxy_server/
├── utils_proxy_open/           # Основные модули
│   ├── __init__.py
│   ├── key_manager.py         # Управление API-ключами
│   ├── request_handler.py     # Обработка HTTP-запросов
│   ├── retry_manager.py       # Управление повторными попытками
│   ├── config_manager.py      # Управление конфигурацией
│   ├── logger_setup.py        # Настройка логирования
│   ├── background_tasks.py    # Фоновые задачи
│   └── proxy_handler.py       # Основной обработчик прокси
├── config.ini                 # Файл конфигурации
├── keys.csv                   # Файл с API-ключами
├── proxy.log                  # Файл логов
└── main.py                    # Точка входа
```

## Требования
- Python 3.8+
- FastAPI
- aiohttp
- uvicorn

## Установка
1. Клонируйте репозиторий
2. Установите зависимости: `pip install -r requirements.txt`
3. Настройте config.ini
4. Добавьте API-ключи в keys.csv

## Конфигурация
Основные параметры настраиваются в файле config.ini:
- api_url: URL API OpenRouter
- request_timeout: Таймаут запросов
- max_retries: Максимальное количество попыток
- retry_delay: Начальная задержка между попытками
- key_recovery_interval: Интервал проверки невалидных ключей

## Запуск
```bash
py main.py
```

## Логирование
Все операции логируются в proxy.log с указанием:
- Времени операции
- Используемого API-ключа
- Статуса операции
- Причины ошибок
- Длительности выполнения

## Обработка ошибок
- Автоматическая обработка ошибок 429 (Rate Limit)
- Экспоненциальная задержка между попытками
- Ротация ключей при исчерпании лимитов
- Восстановление невалидных ключей